#!/bin/bash

# Default options
nc_bin=$(command -v nc)
IPv4_regex='^((25[0-5]|2[0-4][0-9]|[01][0-9][0-9]|[0-9]{1,2})[.]){3}(25[0-5]|2[0-4][0-9]|[01][0-9][0-9]|[0-9]{1,2})$'

# Variable options
target=
ssh_port=
ssh_user=
initial_port=
final_port=

if [ -n "${target}" ] && [ -n "${ssh_port}" ] && [ -n "${initial_port}" ] && [ -n "${final_port}" ]; then
    if [[ $(host -t A "${target}" | grep "has address") ]] || \
        [[ $(echo "${target}" | grep -E "${IPv4_regex}" 2> /dev/null) ]]; then
        if [ "${final_port}" -ge "${initial_port}" ]; then
            for port in $(seq "${initial_port}" "${final_port}"); do
                "${nc_bin}" -w 3 "${target}" "${port}" > /dev/null 2>&1 &
            done
            sleep 5
            if [[ $("${nc_bin}" -w 1 -v "${target}" "${ssh_port}" 2> /dev/null | grep -Ei "succeeded|OpenSSH|SSH" 2> /dev/null) ]]; then
                echo "The gates of heaven have opened!"
                echo "Happy hacking!"
                if [ -n "${ssh_user}" ]; then
                    echo " "
                    ssh "${ssh_user}"@"${target}"
                fi
            else
                echo "Have you sure the target has an open SSH port?"
            fi
        else
            echo "Please the initial port needs to be greater than final port!"
        fi
    else
        echo "Please provide a valid target!"
    fi
else
    echo "You need to specify all variables!"
fi
